# Примеры для статьи «Рефакторинг скриптов liquibase»

В этом репозитории вы найдёте примеры, которые использовались для написания статьи «Рефакторинг скриптов liquibase».

Чтобы начать исследовать примеры, необходимо выполнить команду:

```sh
docker compose up -d
```

Эта команда запустит экземпляр PostgreSQL в docker-контейнере и прольёт в него схему из директории `./before`, которая и будет являться стартовой для рефакторинга.

Запуск примеров с изменениями удобнее всего производить из контейнера с предустановленным liquibase, к которому можно подключиться так:

```sh
docker compose attach liquibase-after
```

Каталог `/changelog` контейнера `liquibase-after` примонтирован к директории `./after`, в которой в отдельных каталогах находятся примеры различных видов рефакторинга. Чтобы работать с конкретным примером, необходимо перед командой задать переменную `LIQUIBASE_SEARCH_PATH` с полным путём до каталога этого примера:

```sh
LIQUIBASE_SEARCH_PATH=/changelog/01-formatting liquibase validate
LIQUIBASE_SEARCH_PATH=/changelog/01-formatting liquibase status
LIQUIBASE_SEARCH_PATH=/changelog/01-formatting liquibase unexpected-changesets
LIQUIBASE_SEARCH_PATH=/changelog/01-formatting liquibase update
```

Все примеры являются отредактированной копией схемы из каталога `./before` и уже учитывают необходимые противодействия для данного вида изменения.

Редактировать примеры можно на хосте в любом удобном редакторе, перезапускать контейнеры после редактирования не нужно. Чтобы лучше понять механизмы рефакторинга, рекомендую вносить изменения в исследуемый пример, сохранять его, и сразу запускать команды `status` и `unexpected-changesets`.

Подключиться к БД можно с помощью любого удобного инструмента с использованием следующих параметров:

```sh
psql postgresql://postgres:postgres@localhost:5432/postgres
```
